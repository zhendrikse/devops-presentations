<!DOCTYPE html>
<html>
  <head>
    <title>Coders should test, testers should code</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">
class: inverse
layout: true
---
class: center, middle

# Coders should test

# Testers should code

.footnote[
by [Zeger Hendrikse](https://www.it-essence.nl/)
]

---
# Goals

- Coding and testing are two sides of the same coin
- Live demo of (an introduction to) TDD

---

# Rulez of the game

- Questions are allowed at all times
--

- The example is meant to illustrate _the TDD process_
--

  - The goal is **not** to write the best _Javascript_ ever!
--

  - User story is not the most realistic either
--

- Very, very, very small steps:

  ![red green refactor](./images/redgreenrefactor.png)

---

# Who is doing what

- Raise your hand if you write unit test afterwards
--

- Raise your hand if you write unit test beforehand
--

- Raise your hand if you do TDD

---

# TDD is not building a bridge nor house!

![cartoon](./images/tdd_cartoon.png)

---

# User story

As a worker in a restaurant 

I want to place my plates on a stack 

so that I always have clean plates available to serve dishes

---

# Let's create a plan

- Start with an empty stack
- Define pop on an empty stack
- Define push on an empty stack
- Define pop on a non-empty stack
- Define multiple pushes and pops

--
.footnote[
Credits to Kent Beck!
]

---

# Sneak preview

![Outlook](images/stack.png)

.footnote[
slightly modified taken from [Uncle Bob's lesson 4](https://www.youtube.com/watch?v=58jGpV2Cg50)
]


---

## First verify we can write a test

```javascript
describe("An unimplemented stack", function () {
  it("should do nothing", function () {
      expect(true).toEqual(true);
  })
})
```

--

###Which results in:

![Output](images/stack1.png)

---

## An empty stack should be... empty?

```javascript
describe("A new stack", function () {
  it("should be empty", function () {
    var myStack = new Stack()
    expect(myStack.isEmpty()).toEqual(true);
  })
})
```
--

### For this we need
```javascript
class Stack {
  isEmpty() {
    return true
  }
}
```

---

# Our updated plan

- ~~Start with an empty stack~~ &#10003;
- Define pop on an empty stack
- Define push on an empty stack
- Define pop on a non-empty stack
- Define multiple pushes and pops

---
## Pop on an empty stack

```javascript
...
  it("should throw an exception on a pop operation", function() {
    var myStack = new Stack()
    expect( function(){ myStack.pop() } )
      .toThrow(new Error("Stack underflow"));
  })
...
```
--

### For this we need
```javascript
class Stack {
  ...
  pop() {
    throw new Error("Stack underflow")
  }
}
```

---
## Red, green, ... refactor!

### DRY

```javascript
describe("A new stack", function () {
  var myStack;

  beforeEach(function() {
      myStack = new Stack()
  })

  it("should be empty", function () {
    expect(myStack.isEmpty()).toEqual(true);
  })

  it("should throw an exception on a pop operation", function() {
    expect( function(){ myStack.pop() } )
      .toThrow(new Error("Stack underflow"));
  })
})
```

---

# Our updated plan

- ~~Start with an empty stack~~ &#10003;
- ~~Define pop on an empty stack~~ &#10003;
- Define push on an empty stack
- Define pop on a non-empty stack
- Define multiple pushes and pops

---
## Push something onto the stack

```javascript
...
  it("should not be empty after a push operation", function() {
    myStack.push(8)
    expect(myStack.isEmpty()).toEqual(false);
  })
...
```
--

```javascript
class Stack {
  constructor() {
    this.stackIsEmtpy = true
  }

  isEmpty() {
    return this.stackIsEmtpy
  }

  push(newElement) {
    this.stackIsEmtpy = false
  }
  ...
```

---
## ... And pop it from the stack

```javascript
  it("should be empty after one push and one pop", function() {
    myStack.push(8)
    myStack.pop()
    expect(myStack.isEmpty()).toEqual(true);
  })
```

--

```javascript
class Stack {
  ...

  pop() {
    if (this.stackIsEmtpy)
      throw new Error("Stack underflow")
    this.stackIsEmtpy = true
  }
  ...
```

---
## DRY revisited

```javascript
describe("A new stack", function () {
  var myStack;

  beforeEach(function () {
    myStack = new Stack()
  })

  ...

  describe("which had one push", function () {
    beforeEach(function () {
      myStack.push(8)
    })
    it("should not be empty", function () {
      expect(myStack.isEmpty()).toEqual(false);
    })
    it("should be empty after one pop", function () {
      myStack.pop()
      expect(myStack.isEmpty()).toEqual(true);
    })
  })
})
```

---

# Our updated plan

- ~~Start with an empty stack~~ &#10003;
- ~~Define pop on an empty stack~~ &#10003;
- ~~Define push on an empty stack~~ &#10003;
- Define pop on a non-empty stack
- Define multiple pushes and pops


---
## Two pushes and one pop!?

```javascript
  ...
  it("should not be empty after 2 pushes and 1 pop", function() {
    myStack.push(8)
    myStack.push(9)
    myStack.pop()
    expect(myStack.isEmpty()).toEqual(false);
  })
  ...
```

---
## Introduction of size inevitable!

```javascript
class Stack {
  constructor() {
    this.stackIsEmtpy = true
    this.size = 0
  }

  isEmpty() {
    return this.size == 0
  }

  pop() {
    if (this.stackIsEmtpy)
      throw new Error("Stack underflow")
    this.stackIsEmtpy = true
    --this.size
  }

  push(newElement) {
    this.stackIsEmtpy = false
    this.size++
  }
}
```

--- 
## We can refactor

---

## Red, green, ... refactor!

```javascript
class Stack {
  constructor() {
    this.size = 0
  }

  isEmpty() {
    return this.size == 0
  }

  pop() {
    if (this.isEmpty())
      throw new Error("Stack underflow")
    --this.size
  }

  push(newElement) {
    this.size++
  }
}
```

---
## Does the pop actually work?

```javascript
...
    it("should pop the pushed element", function () {
      expect(myStack.pop()).toEqual(8)
    })
....
```
--

```javascript
...
  pop() {
    if (this.isEmpty())
      throw new Error("Stack underflow")
    --this.size
    return 8
  }
...
```

---

# Our updated plan

- ~~Start with an empty stack~~ &#10003;
- ~~Define pop on an empty stack~~ &#10003;
- ~~Define push on an empty stack~~ &#10003;
- ~~Define pop on a non-empty stack~~ &#10003;
- Define multiple pushes and pops

---
## Let's extend the test

```javascript
...
    it("should pop the pushed element", function () {
      expect(myStack.pop()).toEqual(8)
      myStack.push(9)
      expect(myStack.pop()).toEqual(9)
    })
....
```

--

```javascript
class Stack {
  constructor() {
    this.size = 0
    this.element = -1
  }

  isEmpty() { return this.size == 0 }

  pop() {
    if (this.isEmpty())
      throw new Error("Stack underflow")
    --this.size
    return this.element;
  }

  push(newElement) {
    this.size++
    this.element = newElement
  }
}
```

---

## Multiple push and pop

```javascript
    it("should pop 2 elements after another push", function() {
      myStack.push(9)
      expect(myStack.pop()).toEqual(9)
      expect(myStack.pop()).toEqual(8)
    })
```

```javascript
class Stack {
  constructor() {
    this.size = 0
    this.element = []
  }

  isEmpty() { return this.size == 0 }

  pop() {
    if (this.isEmpty())
      throw new Error("Stack underflow")
    
    return this.element[--this.size];
  }

  push(newElement) {
    this.element[this.size++] = newElement
  }
}
```
---

# Retrospective

- Tests become more _specific_, codes becomes more _generic_
--

- [TBD](../ci-tbd/index.html) is a no-brainer
--

- Difficulty is postponing "the gold"
--

- Contravariant test suite
--

- 1, 2, N
--

- Tests grouped according to shared set-up
--

- What is still left to test?

---

# It's only the beginning...

- [Mocks, stubs, fakes, spies, ...](https://martinfowler.com/articles/mocksArentStubs.html)
--

- [London school / Detroit school](https://blog.devgenius.io/detroit-and-london-schools-of-test-driven-development-3d2f8dca71e5)
--

- Developer tests his own code: [the nightmare of every auditor!](../four-eyes/index.html)



    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
var slideshow = remark.create({
  // Customize slide number label, either using a format string..
  slideNumberFormat: 'Slide %current% of %total%',
  // .. or by using a format function
  slideNumberFormat: function (current, total) {
    return 'Slide ' + current + ' of ' + total;
  },

  countIncrementalSlides: false,
  highlightLanguage: 'java',
  highlightStyle: 'monokai',
}); 
    </script>
  </body>
</html>
